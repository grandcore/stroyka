
# OpenSchool

Данный проект создан с целью создать темплейт для дальнейшей разработки наших приложений.

## Содержание



**DevOps:**

- 22
- 22


## Функционал тестового приложения

**Xxx**

- 22
- 22

## Запуск на локальной машине

Для сборки и запуска проекта необходимо установить [docker](https://www.docker.com/https://www.docker.com/get-started) и [docker-compose](https://docs.docker.com/compose/install/). Также необходимо запустить [docker daemon](https://docs.docker.com/config/daemon/), если он не запущен.

Для построения и запуска проекта создан _Makefile_. Для пользователей Windows необходимо произвести [дополнительную настройку](https://stackoverflow.com/questions/2532234/how-to-run-a-makefile-in-windows)

**Примечания**

- Архитектура проекта описывается и обсуждается в [Trello](https://trello.com/b/POeLUekC)
- Все контейнеры находятся в одной сети network

### Список приложений

_Если сборка прошла успешно и все контейнеры запущены, то по следующим адресам доступны приложения:_

- router ([localhost:3000](http://localhost:3000)) - точка входа. Роутер Nginx;
- backend ([localhost:3100](http://localhost:3100)) - Авторизация, которая может работать в том числе в других проектах.


- frontend (контейнер frontend) ([localhost:5000](http://localhost:5000)) - Отрисовка всего фронта, кроме админки и процессов. На текущей момент выводит html файл со всеми ссылками на все приложения. 


_Все приложения также доступны по следующим адресам:_
- [localhost:3000/api/api-name](localhost:3000/api/api-name)
- [localhost:3000](localhost:3000) - frontend

Приложения находятся в одной сети. Изнутри любого контейнера их можно перекрёстно пропинговать по названию приложения. Например: `ping admin`.


### Команды make
Все make команды устроены следующим образом: `make [command_name]` для взаимодействия сразу со всеми контейнерами. Если необходимо работать только с одним конкретным контейнером, то необходимо использовать параметр `c`: `make [command_name] с=[container_name]`.
### Команды запуска

- `make build` - сборка всей сети контейнеров без последующего поднятия;
- `make up` - поднять сеть и все контейнеры;
- `make bu` - пересобрать все контейнеры и поднять их. 

### Команды управления состоянием

- `make pause` - приостановить выполнение всех контейнеров с сохранением их состояния;
- `make unpase` - возобновить выполнение всех контейнеров, если они были приостановлены;
- `make stop` - остановка всех контейнеров;
- `make down` - остановка всех контейнеров с последующим удалением;
- `make restart` - перезапуск всех контейнеров;
- `make destroy` - остановка всех контейнеров с удалением контейнеров, volumes и сети;
- `make recreate` - остановка и удаление, а затем создание званого и запуск контейнеров. 

### Команды контроля и обслуживания

- `make logs` - подключиться к выводу логов с контейнера конкретного приложения (см. список выше);
- `make ps` - вывести список и статус работающих контейнеров только из тех, которые определены в _docker-compose.yml_;
- `make login` - подключиться к терминалу контейнера конкретного приложения (см. список выше). Данную команду необходимо использовать только с параметром `c`, который задает имя контейнера;
- `make db-shell` - подключиться к базе данных в контейнере. Для выбора контейнера с бд необходимо написать команду `make db-shell c=db-default`, если например нужно подключиться к `db-default`.

### Запуск без Makefile

- `docker-compose up --build - Собрать и запустить`

### Переменные среды

Переменные среды каждого контейнера находятся в папке _`envs`_. Название каждого файла соответствует названию контейнера: _container_name-variables.env_.
В каждой папке сервиса находится `Dockerfile` в котором определены основные настройки каждого контейнера.




### Базы данных

В качестве базы данных используется [Mongodb](https://www.mongodb.com/). Каждая база данных в текущей версии имеет две установленные переменные среды:

- `MONGO_INITDB_ROOT_USERNAME: root`
- `MONGO_INITDB_ROOT_PASSWORD: example`

_Порты для каждой бд установлены следующим образом:_

- `database - 4100`


Каждая база данных монтируется в свою папку, которые находятся в каталоге `data`, который находится в корне проекта (Осторожно! При запуске происходит проброс данных из контейнера. Файлы могут не иметь прав доступа для редактирования без рута).

